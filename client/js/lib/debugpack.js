webpackJsonp([4],{0:function(a,b,c){a.exports=c(110)},93:function(a,b,c){function d(a){this._name=a,this._index=0,this._parentIndex=d.NO_PARENT,this._inverseBindPose=new e}var e=c(41);d.NO_PARENT=-32768,a.exports=d},95:function(a,b,c){function d(a){this._skeleton=a,this._localTransforms=[],this._globalTransforms=[],this._matrixPalette=[],this._poseListeners=[],this.allocateTransforms(),this.setToBindPose()}var e=c(41),f=c(93),g=c(33);d.prototype.allocateTransforms=function(){for(var a=this._skeleton._joints.length,b=0;a>b;b++)this._localTransforms[b]=new e;for(var b=0;a>b;b++)this._globalTransforms[b]=new e;for(var b=0;a>b;b++)this._matrixPalette[b]=new g},d.prototype.setToBindPose=function(){for(var a=0;a<this._localTransforms.length;a++){this._localTransforms[a].matrix.copy(this._skeleton._joints[a]._inverseBindPose.matrix).invert();var b=this._skeleton._joints[a]._parentIndex;b!==f.NO_PARENT&&this._localTransforms[a].matrix.mul2(this._skeleton._joints[b]._inverseBindPose.matrix,this._localTransforms[a].matrix)}this.updateTransforms()},d.prototype.updateTransforms=function(){for(var a=this._skeleton._joints,b=0,c=a.length;c>b;b++){var d=a[b]._parentIndex;d!==f.NO_PARENT?this._globalTransforms[b].matrix.mul2(this._globalTransforms[d].matrix,this._localTransforms[b].matrix):this._globalTransforms[b].matrix.copy(this._localTransforms[b].matrix),this._matrixPalette[b].mul2(this._globalTransforms[b].matrix,a[b]._inverseBindPose.matrix)}this.firePoseUpdated()},d.prototype.firePoseUpdated=function(){for(var a=this._poseListeners.length-1;a>=0;a--)this._poseListeners[a].poseUpdated(this)},d.prototype.clone=function(){return new d(this._skeleton)},a.exports=d},110:function(a,b,c){if(a.exports={BoundingVolumeMeshBuilder:c(111),MarkerComponent:c(113),DebugDrawHelper:c(114),Debugger:c(141),EntityCounter:c(143),CameraDebug:c(116),LightDebug:c(115),MeshRendererDebug:c(118),SkeletonDebug:c(119),DebugRenderSystem:c(144),MarkerSystem:c(142)},"undefined"!=typeof window)for(var d in a.exports)window.goo[d]=a.exports[d]},111:function(a,b,c){function d(){}function e(a,b,c){var d=[a,b,c,a,b,-c,a,-b,c,a,-b,-c,-a,b,c,-a,b,-c,-a,-b,c,-a,-b,-c],e=[0,1,0,2,1,3,2,3,4,5,4,6,5,7,6,7,0,4,1,5,2,6,3,7],f=new k(k.defaultMap([k.POSITION]),d.length/3,e.length);return f.getAttributeBuffer(k.POSITION).set(d),f.getIndexBuffer().set(e),f.indexLengths=null,f.indexModes=["Lines"],f}function f(a,b){a=a||1,b=b||8;for(var c=[],d=[],e=2*Math.PI/b,f=0,g=0;b>f;f++,g+=e)c.push(Math.cos(g)*a,Math.sin(g)*a,0),d.push(f,f+1);d[d.length-1]=0;var h=new k(k.defaultMap([k.POSITION]),b,d.length);return h.getAttributeBuffer(k.POSITION).set(c),h.getIndexBuffer().set(d),h.indexLengths=null,h.indexModes=["Lines"],h}function g(a){a=a||1;var b,c=new j,d=128,e=f(a,d);b=new l,c.addMeshData(e,b),b=new l,b.rotation.fromAngles(0,Math.PI/2,0),b.update(),c.addMeshData(e,b),b=new l,b.rotation.fromAngles(Math.PI/2,Math.PI/2,0),b.update(),c.addMeshData(e,b);var g=c.build();return g[0]}var h=c(7),i=c(13),j=c(112),k=c(14),l=c(41);d.buildBox=function(a){var b=e(a.xExtent,a.yExtent,a.zExtent);return b},d.buildSphere=function(a){var b=g(a.radius);return b},d.build=function(a){return a instanceof h?d.buildBox(a):a instanceof i?d.buildSphere(a):void 0},a.exports=d},113:function(a,b,c){function d(a){e.apply(this,arguments),this.type="MarkerComponent";var b=a.meshRendererComponent.worldBound;this.meshData=f.build(b)}var e=c(20),f=c(111);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,a.exports=d},114:function(a,b,c){var d=c(95),e=c(51),f=c(52),g=c(115),h=c(116),i=c(118),j=c(119),k=c(30),l=c(46),m=c(41),n=c(120),o=c(123),p={},q=new g,r=new h,s=new i,t=new j;p.getRenderablesFor=function(a,b){var c,e;if("LightComponent"===a.type)c=q.getMesh(a.light,b),e=new k(l.simpleColored,"DebugDrawLightMaterial");else if("CameraComponent"===a.type)c=r.getMesh(a.camera,b),e=new k(l.simpleLit,"DebugDrawCameraMaterial"),e.uniforms.materialAmbient=[.4,.4,.4,1],e.uniforms.materialDiffuse=[.6,.6,.6,1],e.uniforms.materialSpecular=[0,0,0,1];else if("MeshRendererComponent"===a.type)c=s.getMesh(),e=new k(l.simpleColored,"DebugMeshRendererComponentMaterial");else if(a instanceof d){c=t.getMesh(a,b);for(var f=[new k(l.uber,"SkeletonDebugMaterial"),new k(l.uber,"SkeletonDebugMaterial")],g=[],h=f.length;h--;){var e=f[h];e.depthState={enabled:!1,write:!1},e.renderQueue=3e3,e.uniforms.materialDiffuse=[0,0,0,1],e.uniforms.materialDiffuse[h]=.8,e.uniforms.materialAmbient=[0,0,0,1],e.uniforms.materialAmbient[h]=.5,g[h]={meshData:c[h],transform:new m,materials:[e],currentPose:a}}return g}return c.map(function(a){return{meshData:a,transform:new m,materials:[e]}})},p.update=function(a,b,c,d){if(b.camera){var c=b.camera;d&&d.checkResize(c,!0),b.camera.changedProperties&&(a.length>1&&(c.far/c.near!==a[1].farNear||c.fov!==a[1].fov||c.size!==a[1].size||c.aspect!==a[1].aspect||c.projectionMode!==a[1].projectionMode)&&(a[1].meshData=h.buildFrustum(c),a[1].farNear=c.far/c.near,a[1].fov=c.fov,a[1].size=c.size,a[1].aspect=c.aspect,a[1].projectionMode=c.projectionMode),b.camera.changedProperties=!1)}p[b.type].updateMaterial(a[0].materials[0],b),a[1]&&p[b.type].updateMaterial(a[1].materials[0],b),a[1]&&p[b.type].updateTransform(a[1].transform,b);var f=o.mainCamera;if(f){var g=f.translation,i=a[0].transform.translation.distance(g)/30;f.projectionMode===n.Parallel&&(i=(f._frustumTop-f._frustumBottom)/20),a[0].transform.scale.setDirect(i,i,i),a[0].transform.update(),b.light&&b.light instanceof e&&(a[1]&&a[1].transform.scale.scale(i),a[1]&&a[1].transform.update())}},p.LightComponent={},p.CameraComponent={},p.LightComponent.updateMaterial=function(a,b){var c=b.light,d=a.uniforms.color=a.uniforms.color||[];d[0]=c.color.x,d[1]=c.color.y,d[2]=c.color.z},p.LightComponent.updateTransform=function(a,b){var c=b.light;if(!(c instanceof e)){var d=c.range;if(a.scale.setDirect(d,d,d),c instanceof f){var g=c.angle*Math.PI/180,h=Math.tan(g/2);a.scale.mulDirect(h,h,1)}}a.update()},p.CameraComponent.updateMaterial=function(a){a.uniforms.color=a.uniforms.color||[1,1,1]},p.CameraComponent.updateTransform=function(){},a.exports=p},115:function(a,b,c){function d(){this._ball=new n(12,12,.3),this._pointLightMesh=d._buildPointLightMesh(),this._spotLightMesh=d._buildSpotLightMesh(),this._directionalLightMesh=d._buildDirectionalLightMesh()}function e(a,b){a=a||1,b=b||8;for(var c=[],d=[],e=2*Math.PI/b,f=0,g=0;b>f;f++,g+=e)c.push(Math.cos(g)*a,Math.sin(g)*a,0),d.push(f,f+1);d[d.length-1]=0;var h=new k(k.defaultMap([k.POSITION]),b,d.length);return h.getAttributeBuffer(k.POSITION).set(c),h.getIndexBuffer().set(d),h.indexLengths=null,h.indexModes=["Lines"],h}function f(){var a,b=1,c=new l,d=128,f=e(b,d);a=new m,c.addMeshData(f,a),a=new m,a.rotation.fromAngles(0,Math.PI/2,0),a.update(),c.addMeshData(f,a),a=new m,a.rotation.fromAngles(Math.PI/2,Math.PI/2,0),a.update(),c.addMeshData(f,a);var g=c.build();return g[0]}function g(a){a=a||8;for(var b=[0,0,0],c=[],d=2*Math.PI/a,e=0,f=0;a>e;e++,f+=d)b.push(Math.cos(f),Math.sin(f),1),c.push(0,e+1);var g=new k(k.defaultMap([k.POSITION]),a+1,c.length);return g.getAttributeBuffer(k.POSITION).set(b),g.getIndexBuffer().set(c),g.indexLengths=null,g.indexModes=["Lines"],g}function h(){for(var a=-1,b=new l,c=64,d=2,f=a/2,h=f,i=1;d>=i;i++){var j=e(h*i,c),k=new m;k.translation.setDirect(0,0,f*i),k.update(),b.addMeshData(j,k)}var n=g(4),k=new m;k.scale.setDirect(h*d,h*d,f*d),k.update(),b.addMeshData(n,k);var o=b.build();return o[0]}function i(a){a=a||8;for(var b=[],c=[],d=2*Math.PI/a,e=0,f=0;a>e;e++,f+=d)b.push(Math.cos(f),Math.sin(f),0),b.push(Math.cos(f),Math.sin(f),1),c.push(2*e,2*e+1);var g=new k(k.defaultMap([k.POSITION]),2*a,c.length);return g.getAttributeBuffer(k.POSITION).set(b),g.getIndexBuffer().set(c),g.indexLengths=null,g.indexModes=["Lines"],g}function j(){for(var a=new l,b=64,c=2,d=10/c,f=1,g=0;c>g;g++){var h=e(f,b),j=new m;j.translation.z=-d*g,j.update(),a.addMeshData(h,j)}var k=i(4),j=new m;j.scale.setDirect(f,f,-d*c),j.update(),a.addMeshData(k,j);var n=a.build();return n[0]}var k=c(14),l=c(112),m=c(41),n=c(29),o=c(49),p=c(51),q=c(52);d.prototype.getMesh=function(a,b){return a instanceof o?b.full?[this._ball,this._pointLightMesh]:[this._ball]:a instanceof q?b.full?[this._ball,this._spotLightMesh]:[this._ball]:a instanceof p?b.full?[this._ball,this._directionalLightMesh]:[this._ball]:void 0},d._buildPointLightMesh=function(){return f()},d._buildSpotLightMesh=function(){return h()},d._buildDirectionalLightMesh=function(){return j()},a.exports=d},116:function(a,b,c){function d(){this._camera=d.buildCamera()}var e=c(14),f=c(112),g=c(41),h=c(8),i=c(27),j=c(117);d.prototype.getMesh=function(a,b){return b.full?[this._camera,d.buildFrustum(a)]:[this._camera]},d.buildFrustum=function(a){var b,c,d=a.near,f=a.far,g=a.aspect;if(0===a.projectionMode){var h=Math.tan(a.fov/2*Math.PI/180);b=h*f,c=h*d}else{var i=a.size||100;b=i,c=i}var j,k,l,m;j={x:-b*g,y:b,z:-f},k={x:-b*g,y:-b,z:-f},l={x:b*g,y:-b,z:-f},m={x:b*g,y:b,z:-f};var n,o,p,q;n={x:-c*g,y:c,z:-d},o={x:-c*g,y:-c,z:-d},p={x:c*g,y:-c,z:-d},q={x:c*g,y:c,z:-d};var r=[];r.push(j.x,j.y,j.z),r.push(k.x,k.y,k.z),r.push(l.x,l.y,l.z),r.push(m.x,m.y,m.z),r.push(n.x,n.y,n.z),r.push(o.x,o.y,o.z),r.push(p.x,p.y,p.z),r.push(q.x,q.y,q.z);var s=[];s.push(0,1),s.push(1,2),s.push(2,3),s.push(3,0),s.push(4,5),s.push(5,6),s.push(6,7),s.push(7,4),s.push(0,4),s.push(1,5),s.push(2,6),s.push(3,7);var t=new e(e.defaultMap([e.POSITION]),8,24);return t.getAttributeBuffer(e.POSITION).set(r),t.getIndexBuffer().set(s),t.indexLengths=null,t.indexModes=["Lines"],t},d.buildCamera=function(){var a=new f,b=new g,c=new j(32,.6),d=new j(32,.6),k=new i(.3,1,1.6),l=new i(.2,.15,.7);l.applyFunction(e.POSITION,function(a){return new h(a.x+a.x/(.3*(a.z+1.1)),a.y+a.y/(.3*(a.z+1.1)),a.z)}),b.translation.setDirect(0,0,0),b.update(),a.addMeshData(l,b),b.translation.setDirect(0,0,1.3),b.update(),a.addMeshData(k,b),b.scale.setDirect(1,1,.5),b.setRotationXYZ(0,Math.PI/2,0),b.translation.setDirect(0,1.2,.6),b.update(),a.addMeshData(c,b),b.translation.setDirect(0,1.2,2),b.update(),a.addMeshData(d,b);var m=a.build();return m[0]},a.exports=d},118:function(a,b,c){function d(){this._meshes=[e(1,1,1),null]}function e(a,b,c){var d=[a,b,c,a,b,-c,a,-b,c,a,-b,-c,-a,b,c,-a,b,-c,-a,-b,c,-a,-b,-c],e=[0,1,0,2,1,3,2,3,4,5,4,6,5,7,6,7,0,4,1,5,2,6,3,7],g=new f(f.defaultMap([f.POSITION]),d.length/3,e.length);return g.getAttributeBuffer(f.POSITION).set(d),g.getIndexBuffer().set(e),g.indexLengths=null,g.indexModes=["Lines"],g}var f=c(14);d.prototype.getMesh=function(){return this._meshes},a.exports=d},119:function(a,b,c){function d(){}var e=c(27),f=c(41),g=c(93),h=c(112),i=c(14),j=new f;d.prototype.getMesh=function(a){var b=a._skeleton._joints;return[this._buildLines(b),this._buildBoxes(b)]},d.prototype._buildBoxes=function(a){var b=new h,c=new e(2,2,2);c.attributeMap.WEIGHTS=i.createAttribute(4,"Float"),c.attributeMap.JOINTIDS=i.createAttribute(4,"Float"),c.rebuildData(),c.rebuild();for(var d=0;d<a.length;d++)j.matrix.copy(a[d]._inverseBindPose.matrix).invert(),this._stuffBox(c,a[d]),b.addMeshData(c,j);var f=b.build(),g=f[0];return this._buildPaletteMap(g,a),g},d.prototype._buildLines=function(a){for(var b=[],c=[],d=[],e=[],f=0,h=j.matrix.data,k=0;k<a.length;k++){var l=a[k];if(l._parentIndex!==g.NO_PARENT){var m=a[l._parentIndex];c.push(1,0,0,0,1,0,0,0),d.push(l._index,0,0,0,m._index,0,0,0),e.push(2*f,2*f+1),f++,j.matrix.copy(l._inverseBindPose.matrix).invert(),b.push(h[12],h[13],h[14]),j.matrix.copy(m._inverseBindPose.matrix).invert(),b.push(h[12],h[13],h[14])}}var n=new i(i.defaultMap([i.POSITION,i.WEIGHTS,i.JOINTIDS]),b.length/3,e.length);return n.indexModes=["Lines"],n.getAttributeBuffer(i.POSITION).set(b),n.getAttributeBuffer(i.WEIGHTS).set(c),n.getAttributeBuffer(i.JOINTIDS).set(d),n.getIndexBuffer().set(e),this._buildPaletteMap(n,a),n},d.prototype._stuffBox=function(a,b){for(var c=a.getAttributeBuffer("WEIGHTS"),d=a.getAttributeBuffer("JOINTIDS"),e=0;e<c.length;e+=4)c[e]=1,d[e]=b._index},d.prototype._buildPaletteMap=function(a,b){for(var c=[],d=0;d<b.length;d++)c[d]=b[d]._index;a.paletteMap=c,a.weightsPerVertex=4},a.exports=d},141:function(module,exports,__webpack_require__){function Debugger(a){this.goo=null,this.exportPicked=a||!1,this.picked=null,this.oldPicked=null}function createPanel(){var a=document.createElement("div");a.id="debugdiv";var b='<span style="font-size: x-small;font-family: sans-serif">Filter</span><br /><textarea cols="30" id="debugparams">name, Compo, tran, data</textarea><br /><span style="font-size: x-small;font-family: sans-serif">Result</span><br /><textarea readonly rows="10" cols="30" id="debugtex">Click on an entity</textarea><br />';b+='<hr /><span style="font-size: x-small;font-family: sans-serif">REPL</span><br /><textarea readonly rows="10" cols="30" id="replouttex">...</textarea><br /><textarea cols="30" id="replintex">entity.</textarea>',a.innerHTML=b,a.style.position="absolute",a.style.zIndex="2001",a.style.backgroundColor="#DDDDDD",a.style.left="10px",a.style.top="100px",a.style.webkitTouchCallout="none",a.style.webkitUserSelect="none",a.style.khtmlUserSelect="none",a.style.mozUserSelect="none",a.style.msUserSelect="none",a.style.userSelect="none",a.style.padding="3px",a.style.borderRadius="6px",document.body.appendChild(a)}function getFilterList(a){return a.split(",").map(function(a){return a.replace(/(^[\s]+|[\s]+$)/g,"")}).filter(function(a){return a.length>0}).map(function(a){return new RegExp(a)})}function stringifyTypedArray(a){if(0===a.length)return"[]";for(var b="["+a[0],c=1;c<a.length;c++)b+=" "+a[c];return b+="]"}function filterProperties(a,b,c,d){if(0===b.length)return"No interests specified;\n\nSome popular interests: is, tran, Compo\n\nEvery entry separated by a comma is a regex";if(0>d)return c+"REACHED MAXIMUM DEPH\n";if(null===a)return c+"null\n";var e=typeof a;if("undefined"===e||"number"===e||"boolean"===e||"string"===e||a instanceof Array&&("string"==typeof a[0]||"number"==typeof a[0]||"boolean"==typeof a[0]))return c+JSON.stringify(a)+"\n";if(-1!==Object.prototype.toString.call(a).indexOf("Array]"))return c+stringifyTypedArray(a)+"\n";var f=[];for(var g in a)if(a.hasOwnProperty(g)){if("function"==typeof a[g])continue;for(var h in b)if(b[h].test(g)){var i=filterProperties(a[g],b,c+" ",d-1);f.push(c+g+"\n"+i);break}}return f.join("")}function updateMarker(a,b){a!==b?(null!==b&&b.hasComponent("MarkerComponent")&&b.clearComponent("MarkerComponent"),null!==a&&a.setComponent(new MarkerComponent(a))):a.hasComponent("MarkerComponent")?a.clearComponent("MarkerComponent"):a.setComponent(new MarkerComponent(a))}function displayInfo(a){var b=getFilterList(document.getElementById("debugparams").value);a&&console.log("==> ",a);var c=filterProperties(a,b,"",20),d=document.getElementById("debugtex");d.value=c}var MarkerComponent=__webpack_require__(113),MarkerSystem=__webpack_require__(142);Debugger.prototype._setUpREPL=function(){var lastCommStr="";document.getElementById("replintex").addEventListener("keyup",function(event){event.stopPropagation();var replinElemHandle=document.getElementById("replintex"),reploutElemHandle=document.getElementById("replouttex");if(13!==event.keyCode||event.shiftKey)38===event.keyCode&&(replinElemHandle.value=lastCommStr);else{var commStr=replinElemHandle.value.substr(0,replinElemHandle.value.length-1);lastCommStr=commStr;var resultStr="";try{resultStr+=eval(commStr)}catch(err){resultStr+=err}replinElemHandle.value="entity.",reploutElemHandle.value+="\n-------\n"+resultStr,displayInfo(this.picked)}}.bind(this),!1)},Debugger.prototype._setUpPicking=function(){document.addEventListener("mouseup",function(a){a.stopPropagation();var b=a.pageX,c=a.pageY;this.goo.pick(b,c,function(a){var b=this.goo.world.entityManager.getEntityByIndex(a);b&&(this.oldPicked=this.picked,this.picked=b,this.picked===this.oldPicked&&(this.picked=null),this.exportPicked&&(window.picked=this.picked),displayInfo(this.picked),updateMarker(this.picked,this.oldPicked))}.bind(this))}.bind(this),!1)},Debugger.prototype.inject=function(a){return this.goo=a,createPanel(),this.goo.world.getSystem("MarkerSystem")||this.goo.world.setSystem(new MarkerSystem(this.goo)),this._setUpPicking(),document.getElementById("debugparams").addEventListener("keyup",function(){displayInfo(this.picked)}.bind(this)),this._setUpREPL(),this},module.exports=Debugger},142:function(a,b,c){function d(a){e.call(this,"MarkerSystem",["MarkerComponent"]),this.material=new f(g.simpleColored),this.material.depthState.enabled=!1,this.material.shader.uniforms.color=[0,1,0],this.goo=a,this.renderer=this.goo.renderer,this.entities=[],this.goo.callbacks.push(function(){for(var a=0;a<this.entities.length;a++){var b=this.entities[a];if(b.hasComponent("MarkerComponent")){var c=new i;c.copy(b.transformComponent.sync().worldTransform),c.setRotationXYZ(0,0,0),c.scale.setDirect(1,1,1),c.update();var d={meshData:b.markerComponent.meshData,materials:[this.material],transform:c};this.goo.renderer.render(d,h.mainCamera,[],null,!1)}}}.bind(this))}var e=c(42),f=c(30),g=c(46),h=c(123),i=c(41);d.prototype=Object.create(e.prototype),d.prototype.process=function(a){this.entities=a},a.exports=d},143:function(a,b){function c(a){this.goo=null,this.skipFrames=a||20,this.texHandle=null}function d(){var a=document.createElement("div");a.id="_entitycounterdiv";var b='<span style="font-size: x-small;font-family: sans-serif">Counter</span><br /><textarea cols="30" rows="6" id="_entitycountertex">...</textarea>';return a.innerHTML=b,a.style.position="absolute",a.style.zIndex="2001",a.style.backgroundColor="#BBBBBB",a.style.left="10px",a.style.bottom="10px",a.style.webkitTouchCallout="none",a.style.webkitUserSelect="none",a.style.khtmlUserSelect="none",a.style.mozUserSelect="none",a.style.msUserSelect="none",a.style.userSelect="none",a.style.padding="3px",a.style.borderRadius="6px",document.body.appendChild(a),document.getElementById("_entitycountertex")}c.prototype.inject=function(a){this.goo=a,this.texHandle=d();var b=this,c=0;return this.goo.callbacks.push(function(){if(c--,0>=c){c=b.skipFrames;var a="";for(var d in b.goo.world._systems){var e=b.goo.world._systems[d];a+=e.type+": "+e._activeEntities.length+"\n"}b.texHandle.value=a}}),this},a.exports=c},144:function(a,b,c){function d(){e.call(this,"DebugRenderSystem",["TransformComponent"]),this._renderablesTree={},this.renderList=[],this.preRenderers=[],this.composers=[],this.doRender={CameraComponent:!1,LightComponent:!1,MeshRendererComponent:!1,SkeletonPose:!1},this.inserted(),this._interestComponents=["CameraComponent","LightComponent"],this.camera=null,this.lights=[],this.currentTpf=0,this.scale=20,this.cameraListener=function(a){this.camera=a.camera}.bind(this),this.lightsListener=function(a){this.lights=a}.bind(this),this.selectionRenderable=g.getRenderablesFor({type:"MeshRendererComponent"}),this.selectionActive=!1,this.oldSelectionActive=!1}var e=c(42),f=c(44),g=c(114);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setup=function(){f.addListener("goo.setCurrentCamera",this.cameraListener),f.addListener("goo.setLights",this.lightsListener)},d.prototype.inserted=function(){},d.prototype.deleted=function(a){delete this._renderablesTree[a.id]},d.prototype.process=function(a,b){for(var c,d=this.renderList.length=0,e=0;e<a.length;e++){for(var f=a[e],h=0,i=this._interestComponents.length;i>h;h++){var j=this._interestComponents[h];if(!f._hidden&&f.hasComponent(j)){var k=f.getComponent(j);if("none"===k.debugLevel)continue;var l={full:this.doRender[j]||"full"===k.debugLevel},m=this._renderablesTree[f.id]=this._renderablesTree[f.id]||{};if(m[j]&&(2===m[j].length&&l.full||1===m[j].length&&!l.full))c=m[j];else{c=g.getRenderablesFor(k,l);for(var n=0;n<c.length;n++){var o=c[n];o.id=f.id,o._index=f._index}m[j]=c}for(var n=0;n<c.length;n++){var o=c[n];o.transform.translation.set(f.transformComponent.sync().worldTransform.translation),o.transform.rotation.copy(f.transformComponent.sync().worldTransform.rotation),o.transform.scale.setDirect(1,1,1),o.transform.update()}g.update(c,k,this.camera,this.renderer);for(var n=0;n<c.length;n++)this.renderList[d++]=c[n]}}if(this.doRender.SkeletonPose&&f.meshDataComponent&&f.meshDataComponent.currentPose){var p=f.meshDataComponent.currentPose,m=this._renderablesTree[f.id]=this._renderablesTree[f.id]||{};if(m.skeleton)c=m.skeleton;else{c=g.getRenderablesFor(p);for(var n=0;n<c.length;n++)c[n].id=f.id;m.skeleton=c}for(var n=0;n<c.length;n++){var o=c[n];o.transform.copy(f.transformComponent.sync().worldTransform),this.renderList[d++]=o}}}this.selectionActive&&(this.renderList[d++]=this.selectionRenderable[0]),this.renderList.length=d,this.currentTpf=b},d.prototype.render=function(a){this.renderer=a,a.checkResize(this.camera),this.camera&&a.render(this.renderList,this.camera,this.lights,null,!1)},d.prototype.renderToPick=function(a,b){a.renderToPick(this.renderList,this.camera,!1,b)},d.prototype.invalidateHandles=function(a){var b=Object.keys(this._renderablesTree);b.forEach(function(b){var c=this._renderablesTree[b],d=Object.keys(c);d.forEach(function(b){var d=c[b];d.forEach(function(b){b.materials.forEach(function(b){a.invalidateMaterial(b)}),a.invalidateMeshData(b.meshData)})})}.bind(this)),this.selectionRenderable[0].materials.forEach(function(b){a.invalidateMaterial(b)}),a.invalidateMeshData(this.selectionRenderable[0].meshData)},d.prototype.cleanup=function(){f.removeListener("goo.setCurrentCamera",this.cameraListener),f.removeListener("goo.setLights",this.lightsListener)},a.exports=d}});